/**
 * (c) 2013-2015 Nive GmbH - www.nive.co
 * 
 * angular-nive v0.7.1
 * http://www.nive.co
 * 
 * License: MIT
 */
"use strict";angular.module("nive.resource",[]),angular.module("nive.services",["nive.resource"]),angular.module("nive",["nive.services"]),angular.module("nive.services").factory("NiveDataStorageFactory",["NiveAPI",function(e){var n={},t=function(e){this.options(e)};return t.factory=function(e){return new t(angular.isString(e)?{resource:e}:e)},t.prototype={options:function(e,t){switch(!0){case angular.isString(e):if(!angular.isDefined(t))return n[e];n[e]=t;break;case angular.isObject(e):angular.extend(n,e)}return n},getItem:function(n){return angular.isString(n)&&(n={key:n}),e.get(this.options("resource"),"getItem",n,this.options())},newItem:function(n){return angular.isArray(n)&&(n={items:n}),e.post(this.options("resource"),"newItem",n,this.options())},setItem:function(n){return angular.isArray(n)&&(n={items:n}),e.post(this.options("resource"),"setItem",n,this.options())},removeItem:function(n){return angular.isString(n)&&(n={key:n}),e.post(this.options("resource"),"removeItem",n,this.options())},deleteItem:function(e){return this.removeItem(e)},list:function(n){return e.get(this.options("resource"),"list",n,this.options())},keys:function(n){return e.get(this.options("resource"),"keys",n,this.options())}},t.factory}]),angular.module("nive.services").factory("NiveFileHostFactory",["NiveAPI",function(e){var n={},t=function(e){this.options(e)};return t.factory=function(e){return new t(angular.isString(e)?{resource:e}:e)},t.prototype={options:function(e,t){switch(!0){case angular.isString(e):if(!angular.isDefined(t))return n[e];n[e]=t;break;case angular.isObject(e):angular.extend(n,e)}return n},list:function(n){return angular.isString(n)&&(n={path:n}),e.get(this.options("resource"),"@list",n,this.options())},getItem:function(n){return angular.isString(n)&&(n={path:n}),e.get(this.options("resource"),"@getItem",n,this.options())}},t.factory}]),angular.module("nive.services").provider("NiveUser",function(){var e={resource:"users"};this.options=function(n,t){switch(!0){case angular.isString(n):if(!angular.isDefined(t))return e[n];e[n]=t;break;case angular.isObject(n):angular.extend(e,n)}return e},this.$get=["NiveAPI",function(n){return{token:function(t){return n.post(e.resource,"token",t,e)},signin:function(t){return n.post(e.resource,"signin",t,e)},signout:function(){return n.get(e.resource,"signout",null,e)},identity:function(){return n.get(e.resource,"identity",null,e)},name:function(t){return n.get(e.resource,"name",t,e)},profile:function(){return n.get(e.resource,"profile",null,e)},authenticated:function(t){return angular.isArray(t)&&(t={groups:t}),angular.isString(t)&&(t={groups:[t]}),n.get(e.resource,"authenticated",t,e)},signup:function(t){return n.post(e.resource,"signup",t,e)},signup2:function(t){return angular.isString(t)&&(t={token:t}),n.post(e.resource,"signup2",t,e)},update:function(t){return n.post(e.resource,"update",t,e)},updatePassword:function(t){return n.post(e.resource,"updatePassword",t,e)},updateEmail:function(t){return angular.isString(t)&&(t={email:t}),n.post(e.resource,"updateEmail",t,e)},updateEmail2:function(t){return angular.isString(t)&&(t={token:t}),n.post(e.resource,"updateEmail2",t,e)},resetPassword:function(t){return angular.isString()&&(t={identity:t}),n.post(e.resource,"resetPassword",t,e)},resetPassword2:function(t){return n.post(e.resource,"resetPassword2",t,e)}}}]}),angular.module("nive.resource").provider("NiveAPI",function(){var e,n=function(e){return e.data},t=function(n){return e.reject(angular.isObject(n.data)&&n.data.message?n.data.message:"NiveAPI: An unknown error occurred.")};this.successHandler=function(e){return angular.isFunction(e)&&(n=e),n},this.errorHandler=function(e){return angular.isFunction(e)&&(t=e),t},this.$get=["$http","$q",function(r,i){return e=i,{get:function(e,n,t,r){return this.call(e,n,t,"GET",r)},post:function(e,n,t,r){return this.call(e,n,t,"POST",r)},call:function(e,i,o,s,u){s=angular.isString(s)?s:"GET";var a=nive.endpoint.apiUrl(angular.extend({},{name:e,method:i},u||{})),c={};u.token&&(c["x-auth-token"]=u.token);var l=r({method:s,url:a,data:o,params:"GET"===s?o:"",responseType:"json",headers:c});return l.then(n,t)}}}]}),window.nive=window.nive||{},nive.endpoint=nive.endpoint||{},function(){nive.endpoint.apiUrl=function(e){return e=e||{},nive.endpoint.__makeUrl(e,!0)},nive.endpoint.widgetUrl=function(e){return e=e||{},e.version="widgets",nive.endpoint.__makeUrl(e)},nive.endpoint.EndpointException=function(e){this.message=e,this.name="EndpointException"},nive.endpoint.__makeUrl=function(e){e=e||{};var n=".nive.io",t="http://127.0.0.1:5556",r="__domain",i="__proxy",o=e.protocol||document.location.protocol;e.secure?o="https:":o.indexOf(":")!=o.length-1&&(o+=":");var s=e.domain||"";s&&(s=-1==s.indexOf(".")?s+n:s);var u=e.version||"api",a=e.method,c=e.outpost||t,l=0==window.location.href.indexOf(c)?9:0,g=e.path;if(g){if(0==g.indexOf("./")||0==g.indexOf("../"))return g.lastIndexOf("/")!=g.length-1&&(g+="/"),g+a;0==g.indexOf("/")&&(g=g.substr(1,g.length)),g.lastIndexOf("/")==g.length-1&&(g=g.substr(0,g.length-1))}if(!e.name&&!e.relative)throw"Invalid service name";var p=e.name||"",d="";if(9==l){if(""==p)throw"Service name required in development mode";""==s&&(s=r),d=c+"/"+i+"/"+s}else s&&(d=o+"//"+s);return d+="/"+p,u&&(d+="/"+u),g&&(d+="/"+g),a&&(d+="/"+a),d}}();